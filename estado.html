<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Estado de tu Pedido</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<h1 style="text-align:center;margin-top:18px;color:var(--accent)">Seguimiento de tu Pedido</h1>

<div class="container">
  <div class="card">
    <h2 id="nombre"></h2>
    <p><b>ID del pedido:</b> <span id="id"></span></p>
    <hr>
    <div class="loader" style="margin:0 auto 18px"></div>
    <h3>Estado actual</h3>
    <div id="estado" class="estado pendiente">Cargando...</div>
    <hr>
    <h3>Productos</h3>
    <div id="productos"></div>
    <hr>
    <h3>Total: <span id="total"></span></h3>
  </div>
</div>

<script>
const API_BASE = window.API_BASE || "https://restaurante-enpz.onrender.com";
const params = new URLSearchParams(window.location.search);
const idPedido = params.get("id");
document.getElementById("id").textContent = idPedido;

function cargarEstado(){
  fetch(`${API_BASE}/api/pedidos`)
    .then(r=>r.json())
    .then(data=>{
      const pedido = (data||[]).find(p=>p.id == idPedido);
      if(!pedido) return;
      document.getElementById("nombre").textContent = pedido.nombre;
      document.getElementById("total").textContent = "$" + (pedido.total||0).toLocaleString();
      const prodHTML = (pedido.productos||[]).map(p=>`<div>- ${p.nombre} ($${(p.precio||0).toLocaleString()})</div>`).join("");
      document.getElementById("productos").innerHTML = prodHTML;
      const estEl = document.getElementById("estado");
      estEl.textContent = pedido.estado;
      estEl.className = "estado " + pedido.estado.toLowerCase();
    }).catch(()=>{});
}

setInterval(cargarEstado, 3000);
cargarEstado();
</script>
</body>
</html>
